version: "3.3"

services:
  
  api:
      # container_name: api
      # image: api-trello
      
      env_file: .env
      build:
        context: .
        dockerfile: Dockerfile
        target: base
      image: arethel/api-trello
      expose:
      - ${PORT}
      ports:
        # - '4000:4000'
        - ${PORT}:${PORT}
      # command: npm run build && nodemon dist/server.js
      # init: true
      restart: always
      logging:
        driver: json-file
      volumes:
        - ./src:/usr/app/src
        - ./logs:/usr/app/logs
        - ./nodemon.json:/usr/app/nodemon.json
       
      depends_on:
        - postgres
      environment:
          - PORT=${PORT}
      
      networks:
      - trello_clone_network

      command: npm run dev
      
  postgres:
      # image: postgres-trello
      build: ./dataBase/docker
      image: arethel/postgres-trello
      restart: always
      command: postgres -c stats_temp_directory=/tmp
      ports:
       
        - ${POSTGRES_PORT}:${POSTGRES_PORT}
      volumes:
        - ./dataBase/pgdata:/var/lib/postgresql/data
      environment:
        - POSTGRES_USER=${POSTGRES_USER}
        - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
        - POSTGRES_DB=${POSTGRES_DB}
      networks:
      - trello_clone_network
        # trello_clone_network:
        #   aliases:
        #     - postgres
      

networks:
  trello_clone_network:
    driver: bridge

volumes:
  pgdata:
  logs:
    # external: true